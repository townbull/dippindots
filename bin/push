#!/bin/bash

# Copy a file via a SSH tunnel host.
# This is mainly for single files,
# but for folders you can just end it with a '.', e.g. ~/foo/bar/.

# usage:
# push <user@bridgehost> <port> <user> </path/to/file> </path/to/remote/file>
# where <port> is the port used for the SSH tunnel on <bridgehost>
# and <user> is the user used for the remote host

BRIDGE=$1
PORT=$2
USER=$3
FILEPATH=$4
REMOTE_FILEPATH=$5

# scp to bridge
scp $FILEPATH $BRIDGE:/tmp/__pushed

# scp to remote and remove temp file
ssh $BRIDGE 'scp -p '${PORT}' '${USER}'@localhost:/'${REMOTE_FILEPATH}'; rm /tmp/__pushed'