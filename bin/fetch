#!/bin/bash

# Fetch a file via a SSH tunnel host.
# This is mainly for single files,
# but for folders you can just end it with a '.', e.g. ~/foo/bar/.

# usage:
# fetch <user@tunnelhost> <port> <user> </path/to/file>

BRIDGE=$1
PORT=$2
USER=$3
FILEPATH=$4
DIR=`dirname ${FILEPATH}`
FILE=`basename ${FILEPATH}`
ssh $BRIDGE 'ssh -p '${PORT}' '${USER}'@localhost "cd '${DIR}'; tar cj '${FILE}'"' | tar xj