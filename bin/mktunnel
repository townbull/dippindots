#!/bin/bash
# Creates an SSH tunnel via $BRIDGE

BRIDGE=$1
BRIDGEPORT=$2
PORT=$3

createTunnel() {
    /usr/bin/ssh -f -N -R ${PORT}:localhost:22 -L${BRIDGEPORT}:${BRIDGE}:22 ${BRIDGE}
    if [[ $? -eq 0 ]]; then
        echo "Tunnel to ${BRIDGE} created successfully"
    else
        echo "An error occurred creating a tunnel to ${BRIDGE}. Return code: ${?}"
    fi
}
/usr/bin/ssh -p ${BRIDGEPORT} localhost ls > /dev/null
if [[ $? -ne 0 ]]; then
    echo "Creating new tunnel connection to ${BRIDGE}"
    createTunnel
fi
