#!/bin/bash

# Records a region of the screen to a gif
# Adapted from <http://askubuntu.com/a/201018>

# https://github.com/lolilolicon/xrectsel
# also see `man recordmydesktop` for more options
# hit CTRL+C to stop recording
TIME=$(date +"%Y-%m-%d_%H%M%S")
VID=/tmp/recording_${TIME}.ogv
PNG=/tmp/recording_${TIME}
GIF=/tmp/recording_${TIME}.gif
OUT=output_${TIME}.gif
recordmydesktop $(xrectsel "-x=%x -y=%y --width=%w --height=%h") -o $VID --overwrite --fps 30
mkdir $PNG
ffmpeg -i $VID -f image2 $PNG/%04d.png

echo "Creating and optimizing GIF..."
convert -delay 1x30 $PNG/*.png -layers Optimize $GIF
gifsicle -O3 $GIF > $OUT
echo "Preview the gif with 'gifview -a ${OUT}'"