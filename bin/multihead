# Note: run `xrandr -q` to list connected outputs (monitors). Set the appropriate monitor as EXMON.

PLACE=$1
EXMON=HDMI1

function restart_panel {
    # Kill the panel/lemonbar and restart
    ps aux | grep '/usr/bin/panel' | awk '{print $2}' | xargs kill
    panel &
}

# Set this here for convenience
bspc config remove_unplugged_monitors true

if [[ $PLACE == 'right' ]]; then
    EXMON_PLACE=R
    INMON_PLACE=L
elif [[ $PLACE == 'left' ]]; then
    EXMON_PLACE=L
    INMON_PLACE=R
elif [[ $PLACE == 'reset' ]]; then
    xrandr --output $EXMON --off

    # Remove unplugged monitors
    bspc monitor $(bspc query -M) -n eDP1

    restart_panel
    exit 0
else
    echo "Please specify 'left', 'right', or 'reset'."
    exit 0
fi

# Place the external monitor to the specified position
xrandr --output eDP1 --auto --output $EXMON --auto --$PLACE-of eDP1

# Rename each monitor so sxhkd can use it with bspwm to move focus/windows/desktops across monitors
bspc monitor $EXMON -n $EXMON_PLACE
bspc monitor eDP1 -n $INMON_PLACE

# Rename the desktop to match the other ones
bspc desktop Desktop2 -n î†‘

# Reset the wallpaper to render properly
feh --bg-fill ~/.wallpaper.jpg &

restart_panel